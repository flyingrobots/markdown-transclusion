services:
  # Node 18.x testing
  test-node18:
    build:
      context: ../..
      dockerfile: test/docker/Dockerfile.test
      args:
        NODE_VERSION: "18"
    working_dir: /app
    volumes:
      - ../..:/app
      - /app/node_modules
    environment:
      - NODE_ENV=test
    command: npm test

  # Node 20.x testing  
  test-node20:
    build:
      context: ../..
      dockerfile: test/docker/Dockerfile.test
      args:
        NODE_VERSION: "20"
    working_dir: /app
    volumes:
      - ../..:/app
      - /app/node_modules
    environment:
      - NODE_ENV=test
    command: npm test

  # Node 22.x testing
  test-node22:
    build:
      context: ../..
      dockerfile: test/docker/Dockerfile.test
      args:
        NODE_VERSION: "22"
    working_dir: /app
    volumes:
      - ../..:/app
      - /app/node_modules
    environment:
      - NODE_ENV=test
    command: npm test

  # Linting (using Node 20.x)
  lint:
    build:
      context: ../..
      dockerfile: test/docker/Dockerfile.test
      args:
        NODE_VERSION: "20"
    working_dir: /app
    volumes:
      - ../..:/app
      - /app/node_modules
    environment:
      - NODE_ENV=test
    command: npm run lint

  # Type checking (using Node 20.x)
  type-check:
    build:
      context: ../..
      dockerfile: test/docker/Dockerfile.test
      args:
        NODE_VERSION: "20"
    working_dir: /app
    volumes:
      - ../..:/app
      - /app/node_modules
    environment:
      - NODE_ENV=test
    command: npm run type-check